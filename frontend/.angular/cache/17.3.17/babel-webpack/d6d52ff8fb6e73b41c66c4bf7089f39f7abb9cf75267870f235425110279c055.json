{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/llm.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"../atoms/button.component\";\nconst _c0 = [\"chatContainer\"];\nconst _c1 = [\"messageInput\"];\nfunction ChatbotLlmComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 4)(1, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function ChatbotLlmComponent_div_0_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.setIsOpen(true));\n    });\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(2, \"svg\", 6);\n    i0.ɵɵelement(3, \"path\", 7);\n    i0.ɵɵelementEnd()()();\n  }\n}\nfunction ChatbotLlmComponent_div_1_button_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function ChatbotLlmComponent_div_1_button_4_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.setIsOpen(false));\n    });\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(1, \"svg\", 20);\n    i0.ɵɵelement(2, \"path\", 21);\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ChatbotLlmComponent_div_1_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 22)(1, \"div\", 23)(2, \"p\", 24);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const message_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngClass\", message_r5.role === \"user\" ? \"justify-end\" : \"justify-start\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngClass\", message_r5.role === \"user\" ? \"bg-blue-500 text-white\" : \"bg-gray-100 text-gray-800\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(message_r5.content);\n  }\n}\nfunction ChatbotLlmComponent_div_1_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25)(1, \"div\", 26)(2, \"div\", 27);\n    i0.ɵɵelement(3, \"div\", 28)(4, \"div\", 29)(5, \"div\", 30);\n    i0.ɵɵelementEnd()()();\n  }\n}\nfunction ChatbotLlmComponent_div_1_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"p\", 32);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.error);\n  }\n}\nfunction ChatbotLlmComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 8)(2, \"h3\", 9);\n    i0.ɵɵtext(3, \"Chat v\\u1EDBi AI Assistant\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, ChatbotLlmComponent_div_1_button_4_Template, 3, 0, \"button\", 10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 11, 0);\n    i0.ɵɵlistener(\"scroll\", function ChatbotLlmComponent_div_1_Template_div_scroll_5_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onScroll());\n    });\n    i0.ɵɵtemplate(7, ChatbotLlmComponent_div_1_div_7_Template, 4, 3, \"div\", 12)(8, ChatbotLlmComponent_div_1_div_8_Template, 6, 0, \"div\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, ChatbotLlmComponent_div_1_div_9_Template, 3, 1, \"div\", 14);\n    i0.ɵɵelementStart(10, \"form\", 15);\n    i0.ɵɵlistener(\"ngSubmit\", function ChatbotLlmComponent_div_1_Template_form_ngSubmit_10_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onSubmit());\n    });\n    i0.ɵɵelementStart(11, \"div\", 16)(12, \"textarea\", 17, 1);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ChatbotLlmComponent_div_1_Template_textarea_ngModelChange_12_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.input, $event) || (ctx_r1.input = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"keydown\", function ChatbotLlmComponent_div_1_Template_textarea_keydown_12_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onKeyDown($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"app-button\", 18);\n    i0.ɵɵtext(15, \" G\\u1EEDi \");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵclassMapInterpolate1(\"flex flex-col h-[500px] bg-white rounded-lg shadow-lg \", ctx_r1.isBubbleMode ? \"fixed bottom-6 right-6 w-96\" : \"\", \" z-50\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.isBubbleMode);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.messages);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.isLoading);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.error);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.input);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.isLoading);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"isLoading\", ctx_r1.isLoading)(\"disabled\", !ctx_r1.input.trim());\n  }\n}\nexport let ChatbotLlmComponent = /*#__PURE__*/(() => {\n  var _ChatbotLlmComponent;\n  class ChatbotLlmComponent {\n    constructor(llmService) {\n      this.llmService = llmService;\n      this.className = '';\n      this.isBubbleMode = false;\n      this.messages = [];\n      this.input = '';\n      this.isLoading = false;\n      this.error = null;\n      this.isOpen = false;\n      this.shouldScrollToBottom = false;\n    }\n    ngAfterViewChecked() {\n      if (this.shouldScrollToBottom) {\n        this.scrollToBottom();\n        this.shouldScrollToBottom = false;\n      }\n    }\n    setIsOpen(value) {\n      this.isOpen = value;\n    }\n    onSubmit() {\n      if (!this.input.trim() || this.isLoading) return;\n      const userMessage = {\n        role: 'user',\n        content: this.input.trim()\n      };\n      this.messages = [...this.messages, userMessage];\n      this.shouldScrollToBottom = true;\n      const currentInput = this.input;\n      this.input = '';\n      this.isLoading = true;\n      this.error = null;\n      const chatMessages = this.messages.map(m => ({\n        role: m.role,\n        content: m.content\n      }));\n      this.llmService.chat(chatMessages).subscribe({\n        next: response => {\n          const assistantMessage = {\n            role: 'assistant',\n            content: response.answer\n          };\n          this.messages = [...this.messages, assistantMessage];\n          this.shouldScrollToBottom = true;\n          this.isLoading = false;\n        },\n        error: error => {\n          this.error = error.error?.message || 'Có lỗi xảy ra khi gửi tin nhắn';\n          this.isLoading = false;\n        }\n      });\n    }\n    onKeyDown(event) {\n      if (event.key === 'Enter' && !event.shiftKey) {\n        event.preventDefault();\n        this.onSubmit();\n      }\n    }\n    onScroll() {\n      // Handle scroll events if needed\n    }\n    scrollToBottom() {\n      if (this.chatContainer) {\n        this.chatContainer.nativeElement.scrollTop = this.chatContainer.nativeElement.scrollHeight;\n      }\n    }\n  }\n  _ChatbotLlmComponent = ChatbotLlmComponent;\n  _ChatbotLlmComponent.ɵfac = function ChatbotLlmComponent_Factory(t) {\n    return new (t || _ChatbotLlmComponent)(i0.ɵɵdirectiveInject(i1.LlmService));\n  };\n  _ChatbotLlmComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _ChatbotLlmComponent,\n    selectors: [[\"app-chatbot-llm\"]],\n    viewQuery: function ChatbotLlmComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n        i0.ɵɵviewQuery(_c1, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.chatContainer = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.messageInput = _t.first);\n      }\n    },\n    inputs: {\n      className: \"className\",\n      isBubbleMode: \"isBubbleMode\"\n    },\n    decls: 2,\n    vars: 2,\n    consts: [[\"chatContainer\", \"\"], [\"messageInput\", \"\"], [\"class\", \"fixed bottom-6 right-6 w-96 z-50\", 4, \"ngIf\"], [3, \"class\", 4, \"ngIf\"], [1, \"fixed\", \"bottom-6\", \"right-6\", \"w-96\", \"z-50\"], [1, \"w-14\", \"h-14\", \"bg-blue-500\", \"rounded-full\", \"shadow-lg\", \"flex\", \"items-center\", \"justify-center\", \"hover:bg-blue-600\", \"transition-all\", \"duration-300\", \"transform\", \"hover:scale-110\", 3, \"click\"], [\"fill\", \"none\", \"viewBox\", \"0 0 24 24\", \"stroke\", \"currentColor\", 1, \"h-6\", \"w-6\", \"text-white\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\"], [1, \"px-4\", \"py-3\", \"border-b\", \"flex\", \"justify-between\", \"items-center\"], [1, \"text-lg\", \"font-semibold\"], [\"class\", \"text-gray-500 hover:text-gray-700\", 3, \"click\", 4, \"ngIf\"], [1, \"flex-1\", \"overflow-y-auto\", \"p-4\", \"space-y-4\", 3, \"scroll\"], [\"class\", \"flex\", 3, \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"flex justify-start\", 4, \"ngIf\"], [\"class\", \"px-4 py-2 bg-red-50 border-t border-red-200\", 4, \"ngIf\"], [1, \"p-4\", \"border-t\", 3, \"ngSubmit\"], [1, \"flex\", \"space-x-2\"], [\"name\", \"message\", \"placeholder\", \"Nh\\u1EADp tin nh\\u1EAFn...\", 1, \"flex-1\", \"min-h-[44px]\", \"max-h-[120px]\", \"p-2\", \"border\", \"rounded-lg\", \"resize-y\", 3, \"ngModelChange\", \"keydown\", \"ngModel\", \"disabled\"], [\"type\", \"submit\", 3, \"isLoading\", \"disabled\"], [1, \"text-gray-500\", \"hover:text-gray-700\", 3, \"click\"], [\"fill\", \"none\", \"viewBox\", \"0 0 24 24\", \"stroke\", \"currentColor\", 1, \"h-5\", \"w-5\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M6 18L18 6M6 6l12 12\"], [1, \"flex\", 3, \"ngClass\"], [1, \"max-w-[80%]\", \"rounded-lg\", \"px-4\", \"py-2\", 3, \"ngClass\"], [1, \"whitespace-pre-wrap\", \"break-words\"], [1, \"flex\", \"justify-start\"], [1, \"bg-gray-100\", \"rounded-lg\", \"px-4\", \"py-2\"], [1, \"flex\", \"items-center\", \"space-x-2\"], [1, \"w-2\", \"h-2\", \"bg-gray-400\", \"rounded-full\", \"animate-bounce\"], [1, \"w-2\", \"h-2\", \"bg-gray-400\", \"rounded-full\", \"animate-bounce\", 2, \"animation-delay\", \"0.2s\"], [1, \"w-2\", \"h-2\", \"bg-gray-400\", \"rounded-full\", \"animate-bounce\", 2, \"animation-delay\", \"0.4s\"], [1, \"px-4\", \"py-2\", \"bg-red-50\", \"border-t\", \"border-red-200\"], [1, \"text-red-600\", \"text-sm\"]],\n    template: function ChatbotLlmComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, ChatbotLlmComponent_div_0_Template, 4, 0, \"div\", 2)(1, ChatbotLlmComponent_div_1_Template, 16, 11, \"div\", 3);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.isBubbleMode && !ctx.isOpen);\n        i0.ɵɵadvance();\n        i0.ɵɵproperty(\"ngIf\", !ctx.isBubbleMode || ctx.isOpen);\n      }\n    },\n    dependencies: [i2.NgClass, i2.NgForOf, i2.NgIf, i3.ɵNgNoValidate, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgControlStatusGroup, i3.NgModel, i3.NgForm, i4.ButtonComponent],\n    styles: [\".animate-bounce[_ngcontent-%COMP%] {\\n      animation: _ngcontent-%COMP%_bounce 1s infinite;\\n    }\\n\\n    @keyframes _ngcontent-%COMP%_bounce {\\n      0%, 20%, 50%, 80%, 100% {\\n        transform: translateY(0);\\n      }\\n      40% {\\n        transform: translateY(-10px);\\n      }\\n      60% {\\n        transform: translateY(-5px);\\n      }\\n    }\\n  \\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYXRib3QtbGxtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0lBQ0k7TUFDRSw2QkFBNkI7SUFDL0I7O0lBRUE7TUFDRTtRQUNFLHdCQUF3QjtNQUMxQjtNQUNBO1FBQ0UsNEJBQTRCO01BQzlCO01BQ0E7UUFDRSwyQkFBMkI7TUFDN0I7SUFDRiIsImZpbGUiOiJjaGF0Ym90LWxsbS5jb21wb25lbnQudHMiLCJzb3VyY2VzQ29udGVudCI6WyJcbiAgICAuYW5pbWF0ZS1ib3VuY2Uge1xuICAgICAgYW5pbWF0aW9uOiBib3VuY2UgMXMgaW5maW5pdGU7XG4gICAgfVxuXG4gICAgQGtleWZyYW1lcyBib3VuY2Uge1xuICAgICAgMCUsIDIwJSwgNTAlLCA4MCUsIDEwMCUge1xuICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7XG4gICAgICB9XG4gICAgICA0MCUge1xuICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTEwcHgpO1xuICAgICAgfVxuICAgICAgNjAlIHtcbiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01cHgpO1xuICAgICAgfVxuICAgIH1cbiAgIl19 */\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy9tb2xlY3VsZXMvY2hhdGJvdC1sbG0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7SUFDSTtNQUNFLDZCQUE2QjtJQUMvQjs7SUFFQTtNQUNFO1FBQ0Usd0JBQXdCO01BQzFCO01BQ0E7UUFDRSw0QkFBNEI7TUFDOUI7TUFDQTtRQUNFLDJCQUEyQjtNQUM3QjtJQUNGOztBQUVKLG93QkFBb3dCIiwic291cmNlc0NvbnRlbnQiOlsiXG4gICAgLmFuaW1hdGUtYm91bmNlIHtcbiAgICAgIGFuaW1hdGlvbjogYm91bmNlIDFzIGluZmluaXRlO1xuICAgIH1cblxuICAgIEBrZXlmcmFtZXMgYm91bmNlIHtcbiAgICAgIDAlLCAyMCUsIDUwJSwgODAlLCAxMDAlIHtcbiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApO1xuICAgICAgfVxuICAgICAgNDAlIHtcbiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xMHB4KTtcbiAgICAgIH1cbiAgICAgIDYwJSB7XG4gICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNXB4KTtcbiAgICAgIH1cbiAgICB9XG4gICJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n  });\n  return ChatbotLlmComponent;\n})();","map":{"version":3,"names":["i0","ɵɵelementStart","ɵɵlistener","ChatbotLlmComponent_div_0_Template_button_click_1_listener","ɵɵrestoreView","_r1","ctx_r1","ɵɵnextContext","ɵɵresetView","setIsOpen","ɵɵelement","ɵɵelementEnd","ChatbotLlmComponent_div_1_button_4_Template_button_click_0_listener","_r4","ɵɵtext","ɵɵproperty","message_r5","role","ɵɵadvance","ɵɵtextInterpolate","content","error","ɵɵtemplate","ChatbotLlmComponent_div_1_button_4_Template","ChatbotLlmComponent_div_1_Template_div_scroll_5_listener","_r3","onScroll","ChatbotLlmComponent_div_1_div_7_Template","ChatbotLlmComponent_div_1_div_8_Template","ChatbotLlmComponent_div_1_div_9_Template","ChatbotLlmComponent_div_1_Template_form_ngSubmit_10_listener","onSubmit","ɵɵtwoWayListener","ChatbotLlmComponent_div_1_Template_textarea_ngModelChange_12_listener","$event","ɵɵtwoWayBindingSet","input","ChatbotLlmComponent_div_1_Template_textarea_keydown_12_listener","onKeyDown","ɵɵclassMapInterpolate1","isBubbleMode","messages","isLoading","ɵɵtwoWayProperty","trim","ChatbotLlmComponent","_ChatbotLlmComponent","constructor","llmService","className","isOpen","shouldScrollToBottom","ngAfterViewChecked","scrollToBottom","value","userMessage","currentInput","chatMessages","map","m","chat","subscribe","next","response","assistantMessage","answer","message","event","key","shiftKey","preventDefault","chatContainer","nativeElement","scrollTop","scrollHeight","ɵɵdirectiveInject","i1","LlmService","selectors","viewQuery","ChatbotLlmComponent_Query","rf","ctx","ChatbotLlmComponent_div_0_Template","ChatbotLlmComponent_div_1_Template"],"sources":["/Users/huy/Documents/internal-doc-ai/frontend/src/app/components/molecules/chatbot-llm.component.ts"],"sourcesContent":["import { Component, Input, ViewChild, ElementRef, AfterViewChecked } from '@angular/core';\nimport { LlmService, ChatMessage } from '../../services/llm.service';\n\ninterface Message {\n  role: 'user' | 'assistant';\n  content: string;\n}\n\n@Component({\n  selector: 'app-chatbot-llm',\n  template: `\n    <div class=\"fixed bottom-6 right-6 w-96 z-50\" *ngIf=\"isBubbleMode && !isOpen\">\n      <button\n        (click)=\"setIsOpen(true)\"\n        class=\"w-14 h-14 bg-blue-500 rounded-full shadow-lg flex items-center justify-center hover:bg-blue-600 transition-all duration-300 transform hover:scale-110\"\n      >\n        <svg class=\"h-6 w-6 text-white\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\" />\n        </svg>\n      </button>\n    </div>\n\n    <div\n      class=\"flex flex-col h-[500px] bg-white rounded-lg shadow-lg {{ isBubbleMode ? 'fixed bottom-6 right-6 w-96' : '' }} z-50\"\n      *ngIf=\"!isBubbleMode || isOpen\"\n    >\n      <!-- Chat header -->\n      <div class=\"px-4 py-3 border-b flex justify-between items-center\">\n        <h3 class=\"text-lg font-semibold\">Chat với AI Assistant</h3>\n        <button\n          *ngIf=\"isBubbleMode\"\n          (click)=\"setIsOpen(false)\"\n          class=\"text-gray-500 hover:text-gray-700\"\n        >\n          <svg class=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n          </svg>\n        </button>\n      </div>\n\n      <!-- Chat messages -->\n      <div\n        #chatContainer\n        class=\"flex-1 overflow-y-auto p-4 space-y-4\"\n        (scroll)=\"onScroll()\"\n      >\n        <div\n          *ngFor=\"let message of messages\"\n          class=\"flex\"\n          [ngClass]=\"message.role === 'user' ? 'justify-end' : 'justify-start'\"\n        >\n          <div\n            class=\"max-w-[80%] rounded-lg px-4 py-2\"\n            [ngClass]=\"message.role === 'user'\n              ? 'bg-blue-500 text-white'\n              : 'bg-gray-100 text-gray-800'\"\n          >\n            <p class=\"whitespace-pre-wrap break-words\">{{ message.content }}</p>\n          </div>\n        </div>\n\n        <!-- Loading indicator -->\n        <div *ngIf=\"isLoading\" class=\"flex justify-start\">\n          <div class=\"bg-gray-100 rounded-lg px-4 py-2\">\n            <div class=\"flex items-center space-x-2\">\n              <div class=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"></div>\n              <div class=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style=\"animation-delay: 0.2s\"></div>\n              <div class=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style=\"animation-delay: 0.4s\"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Error message -->\n      <div *ngIf=\"error\" class=\"px-4 py-2 bg-red-50 border-t border-red-200\">\n        <p class=\"text-red-600 text-sm\">{{ error }}</p>\n      </div>\n\n      <!-- Input area -->\n      <form (ngSubmit)=\"onSubmit()\" class=\"p-4 border-t\">\n        <div class=\"flex space-x-2\">\n          <textarea\n            #messageInput\n            [(ngModel)]=\"input\"\n            name=\"message\"\n            placeholder=\"Nhập tin nhắn...\"\n            class=\"flex-1 min-h-[44px] max-h-[120px] p-2 border rounded-lg resize-y\"\n            [disabled]=\"isLoading\"\n            (keydown)=\"onKeyDown($event)\"\n          ></textarea>\n          <app-button\n            type=\"submit\"\n            [isLoading]=\"isLoading\"\n            [disabled]=\"!input.trim()\"\n          >\n            Gửi\n          </app-button>\n        </div>\n      </form>\n    </div>\n  `,\n  styles: [`\n    .animate-bounce {\n      animation: bounce 1s infinite;\n    }\n\n    @keyframes bounce {\n      0%, 20%, 50%, 80%, 100% {\n        transform: translateY(0);\n      }\n      40% {\n        transform: translateY(-10px);\n      }\n      60% {\n        transform: translateY(-5px);\n      }\n    }\n  `]\n})\nexport class ChatbotLlmComponent implements AfterViewChecked {\n  @Input() className = '';\n  @Input() isBubbleMode = false;\n\n  @ViewChild('chatContainer') private chatContainer!: ElementRef;\n  @ViewChild('messageInput') private messageInput!: ElementRef;\n\n  messages: Message[] = [];\n  input = '';\n  isLoading = false;\n  error: string | null = null;\n  isOpen = false;\n\n  private shouldScrollToBottom = false;\n\n  constructor(private llmService: LlmService) {}\n\n  ngAfterViewChecked() {\n    if (this.shouldScrollToBottom) {\n      this.scrollToBottom();\n      this.shouldScrollToBottom = false;\n    }\n  }\n\n  setIsOpen(value: boolean): void {\n    this.isOpen = value;\n  }\n\n  onSubmit(): void {\n    if (!this.input.trim() || this.isLoading) return;\n\n    const userMessage: Message = { role: 'user', content: this.input.trim() };\n    this.messages = [...this.messages, userMessage];\n    this.shouldScrollToBottom = true;\n\n    const currentInput = this.input;\n    this.input = '';\n    this.isLoading = true;\n    this.error = null;\n\n    const chatMessages: ChatMessage[] = this.messages.map(m => ({\n      role: m.role,\n      content: m.content\n    }));\n\n    this.llmService.chat(chatMessages).subscribe({\n      next: (response) => {\n        const assistantMessage: Message = {\n          role: 'assistant',\n          content: response.answer\n        };\n        this.messages = [...this.messages, assistantMessage];\n        this.shouldScrollToBottom = true;\n        this.isLoading = false;\n      },\n      error: (error) => {\n        this.error = error.error?.message || 'Có lỗi xảy ra khi gửi tin nhắn';\n        this.isLoading = false;\n      }\n    });\n  }\n\n  onKeyDown(event: KeyboardEvent): void {\n    if (event.key === 'Enter' && !event.shiftKey) {\n      event.preventDefault();\n      this.onSubmit();\n    }\n  }\n\n  onScroll(): void {\n    // Handle scroll events if needed\n  }\n\n  private scrollToBottom(): void {\n    if (this.chatContainer) {\n      this.chatContainer.nativeElement.scrollTop = this.chatContainer.nativeElement.scrollHeight;\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}